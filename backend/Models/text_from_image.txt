Activities 2 Terminal Seps 12:48 0 ° HO

m admin@raspberrypi: ~/Videos Qa = - = «x

import cv2

import requests
import io

from PIL import Image

# GStreamer pipeline string
gst_pipeline = (

"valasrc device=/dev/videod
video/x-raw, width=640, heigh
videoconvert ! appsink"

480, framerate=30/1 ! "

)

# Initialize the webcan using GStreamer pipeline
cap = cv2.VideoCapture(gst_pipeline, cv2.CAP_GSTREAMER)

if not cap.isOpened():
print("Error: Could not open webcam using GStreamer.")

exit()
server_url = 'https://zccksehn-5060.inc1.devtunnels.ms/upload_inage' # Replace with your computer's IP address
while True:

ret, frame = cap.read()

if ret:

# Convert the frame to a PIL Image
pil_image = Image.fromarray(cv2.cvtColor(frame, cv2.COLOR_BGR2RGB))

QLso0oPORBESGC

# Save the image to a bytes buffer
buf = 10.BytesIo()
pil_image.save(buf, format='JPEG')
byte_image = buf.getvalue()

# send the image to the Flask server

try:
response = requests.post(server_url, files={'inage': ('frame.jpg’, byte image, 'image/ipeg’)})
print(response.json())

except Exception as e:
print(f"Failed to send image: {e}")

# Optionally display the frame locally
cv2.inshow(' Live Feed’, frame)

# Exit loop if 'q' is pressed
if cv2.waitKey(1) & OxFF == ord('q'):
break
else:
print("Error: Could not read frame.")
break

cap. release()
cv2.destroyAllWindows (J

-- VISUAL -- 2 51,24 au
